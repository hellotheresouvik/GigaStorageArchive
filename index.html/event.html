<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Event</title>

<style>
body {
  margin: 0;
  padding: 40px;
  font-family: Arial, sans-serif;
  background: white;
  color: black;
}

.container {
  max-width: 700px;
  margin: 0 auto;
}

h1 {
  margin: 0;
  font-size: 28px;
}

.date {
  color: #555;
  margin-bottom: 30px;
}

.section {
  border-top: 1px solid #ddd;
  padding-top: 20px;
  margin-top: 20px;
}

.section h3 {
  margin-bottom: 10px;
  font-size: 16px;
}

button {
  padding: 6px 10px;
  font-size: 12px;
  background: black;
  color: white;
  border: none;
  cursor: pointer;
  margin-top: 6px;
}

input, textarea {
  width: 100%;
  padding: 6px;
  margin-top: 6px;
  font-size: 12px;
}

.icon-btn {
  background: none;
  color: black;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

.link-item {
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div class="container">

  <!-- TITLE -->
  <div style="display:flex; align-items:center; gap:10px;">
    <h1 id="eventTitle"></h1>
    <button id="editTitleBtn" class="icon-btn">✏️</button>
  </div>

  <div id="titleEditor" style="display:none;">
    <input id="titleInputEdit" />
    <button id="saveTitleBtn">Save</button>
  </div>

  <div class="date" id="eventDate"></div>

  <!-- DESCRIPTION -->
  <div class="section">
    <div style="display:flex; align-items:center; gap:10px;">
      <h3>Description</h3>
      <button id="editDescBtn" class="icon-btn">✏️</button>
    </div>

    <div id="eventDescription"></div>

    <div id="descEditor" style="display:none;">
      <textarea id="descInput" rows="4"></textarea>
      <button id="saveDescBtn">Save</button>
    </div>
  </div>

  <!-- DRIVE FOLDERS -->
  <div class="section">
    <h3>Drive Folders</h3>

    <div id="linksContainer"></div>

    <button id="showAddFolderBtn">Add Folder</button>

    <div id="addFolderForm" style="display:none;">
      <input id="linkName" placeholder="Folder name" />
      <input id="linkURL" placeholder="Google Drive link URL" />
      <button id="saveFolderBtn">Save Folder</button>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
  getFirestore,
  doc,
  getDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgg4raJqHu8Ot5AgjLGz9l8smDKzzQPyM",
  authDomain: "gigastoragearchive.firebaseapp.com",
  projectId: "gigastoragearchive",
  storageBucket: "gigastoragearchive.firebasestorage.app",
  messagingSenderId: "223133150846",
  appId: "1:223133150846:web:74d2254f6029d51f18f22f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.getElementById("eventTitle").innerText = "Invalid event";
} else {

  const eventRef = doc(db, "events", id);
  const docSnap = await getDoc(eventRef);

  if (!docSnap.exists()) {
    document.getElementById("eventTitle").innerText = "Event not found";
  } else {

    const data = docSnap.data();

    const eventTitle = document.getElementById("eventTitle");
    const eventDate = document.getElementById("eventDate");
    const eventDescription = document.getElementById("eventDescription");

    eventTitle.innerText = data.title || "";
    eventDate.innerText = data.date || "";
    eventDescription.innerText = data.description || "";

    renderLinks(data.links || []);

    // ---------- TITLE EDIT ----------
    const editTitleBtn = document.getElementById("editTitleBtn");
    const titleEditor = document.getElementById("titleEditor");
    const titleInputEdit = document.getElementById("titleInputEdit");
    const saveTitleBtn = document.getElementById("saveTitleBtn");

    editTitleBtn.addEventListener("click", () => {
      titleInputEdit.value = eventTitle.innerText;
      titleEditor.style.display = "block";
    });

    saveTitleBtn.addEventListener("click", async () => {
      const newTitle = titleInputEdit.value.trim();
      if (!newTitle) return;

      await updateDoc(eventRef, { title: newTitle });
      eventTitle.innerText = newTitle;
      titleEditor.style.display = "none";
    });

    // ---------- DESCRIPTION EDIT ----------
    const editDescBtn = document.getElementById("editDescBtn");
    const descEditor = document.getElementById("descEditor");
    const descInput = document.getElementById("descInput");
    const saveDescBtn = document.getElementById("saveDescBtn");

    editDescBtn.addEventListener("click", () => {
      descInput.value = eventDescription.innerText;
      descEditor.style.display = "block";
    });

    saveDescBtn.addEventListener("click", async () => {
      const newDesc = descInput.value.trim();
      await updateDoc(eventRef, { description: newDesc });
      eventDescription.innerText = newDesc;
      descEditor.style.display = "none";
    });

    // ---------- ADD FOLDER ----------
    const showAddFolderBtn = document.getElementById("showAddFolderBtn");
    const addFolderForm = document.getElementById("addFolderForm");
    const saveFolderBtn = document.getElementById("saveFolderBtn");
    const linkName = document.getElementById("linkName");
    const linkURL = document.getElementById("linkURL");

    showAddFolderBtn.addEventListener("click", () => {
      addFolderForm.style.display = "block";
    });

    saveFolderBtn.addEventListener("click", async () => {
      const name = linkName.value.trim();
      const url = linkURL.value.trim();
      if (!name || !url) return;

      const latestSnap = await getDoc(eventRef);
      const latestData = latestSnap.data();
      const updatedLinks = [...(latestData.links || []), { name, url }];

      await updateDoc(eventRef, { links: updatedLinks });
      renderLinks(updatedLinks);

      linkName.value = "";
      linkURL.value = "";
      addFolderForm.style.display = "none";
    });

    function renderLinks(links) {
      const container = document.getElementById("linksContainer");
      container.innerHTML = "";

      links.forEach(link => {
        const div = document.createElement("div");
        div.className = "link-item";
        div.innerHTML = `<a href="${link.url}" target="_blank">${link.name}</a>`;
        container.appendChild(div);
      });
    }

  }
}
</script>

</body>
</html>
